{% extends 'agent_dashboard.html' %}
{% block title %}View Data{% endblock %}
{% block content %}


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fa;
    }

    .navbar-brand {
      font-weight: 600;
      font-size: 20px;
    }

    .nav-item .nav-link {
      font-weight: 500;
    }

    .user-info {
      font-size: 0.9rem;
      color: #fff;
      background: #198754;
      border-radius: 20px;
      padding: 4px 12px;
      margin-left: auto;
      margin-right: 10px;
    }

.table-container {
  max-height: 70vh;
  overflow-y: auto;
  border: 1px solid #ccc;
}

th, td {
  white-space: nowrap;
  text-align: left !important;
  vertical-align: middle !important;
}

thead th {
  background-color: #343a40;
  color: white;
  position: sticky;
  top: 0;
  z-index: 1;
}

.btn-outline-success, .btn-outline-primary {
  font-weight: 500;
  border-radius: 20px;
}

.table td, .table th {
  padding: 0.75rem 1rem;
  font-size: 14px;
}

  </style>


<div class="container py-4">

<div class="d-flex flex-wrap align-items-center gap-2 mb-3">
  <!-- Date Filter -->
  <input type="date" id="dateFilter" class="form-control" style="width: 160px;" placeholder="Date">

  <!-- Text Search -->
  <input type="text" id="searchInput" class="form-control" style="flex: 1;" placeholder="Search...">

  <!-- Download Button -->
  <a href="/download" class="btn btn-outline-success d-flex align-items-center">
    <i class="bi bi-arrow-down-circle-fill me-1"></i> Download CSV
  </a>
</div>



  <div class="table-container">
    <table class="table table-bordered table-hover align-middle" id="ticketTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Agent</th>
          <th>Ticket</th>
          <th>Ref</th>
          <th>License</th>
          <th>Company</th>
          <th>Server</th>
          <th>Contact</th>
          <th>Lang</th>
          <th>Type</th>
          <th>Query</th>
          <th>Status</th>
          <th>Duration</th>
          <th>Rating</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in call_data %}
        <tr>
          <td>{{ row['date'] }}</td>
          <td>{{ row['time'] }}</td>
          <td>{{ row['agent_name'] }}</td>
          <td>{{ row['ticket_no'] }}</td>
          <td>{{ row['ref_ticket_no'] }}</td>
          <td>{{ row['company_license'] }}</td>
          <td>{{ row['company_name'] }}</td>
          <td>{{ row['company_server'] }}</td>
          <td>{{ row['contact'] }}</td>
          <td>{{ row['language'] }}</td>
          <td>{{ row['query_type'] }}</td>
          <td>{{ row['query'] }}</td>
          <td>
            <span class="badge {{ 'bg-success' if row['status'] == 'Completed' else 'bg-warning text-dark' }}">
              {{ row['status'] }}
            </span>
          </td>
          <td>{{ row['duration'] }}</td>
          <td>{{ row['rating'] }}</td>
          <td>
            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ row['id'] }}">
              <i class="bi bi-pencil-square"></i>
            </button>
          </td>
        </tr>

        <!-- Edit Modal -->
    <div class="modal fade" id="editModal{{ row['id'] }}" tabindex="-1">
  <div class="modal-dialog modal-sm"> <!-- Changed from modal-lg to modal-sm -->
    <div class="modal-content">
      <form action="/edit_ticket_agent/{{ row['id'] }}" method="POST">
        <div class="modal-header bg-warning text-dark py-2"> <!-- Reduced padding -->
          <h6 class="modal-title mb-0">Edit - {{ row['company_license'] }}</h6>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-2">
          <div class="mb-2">
            <label class="form-label required">Status <span class="text-danger">*</span></label>
            <select class="form-select form-select-sm" name="status" required>
              <option value="">Choose...</option>
              <option>Completed</option>
              <option>Underprocessing</option>
              <option>Informed to Dev Team</option>
              <option>Informed to Sales Team</option>
              <option>Informed to Accounts Team</option>
              <option>Other</option>
            </select>
          </div>
          <!-- Add more fields here if needed -->
        </div>
        <div class="modal-footer p-2">
          <button type="submit" class="btn btn-success btn-sm">Save</button>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const dateFilter = document.getElementById('dateFilter');
  const table = document.getElementById('ticketTable');
  const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

  function filterTable() {
    const searchValue = searchInput.value.toLowerCase();
    const dateValue = dateFilter.value;

    for (let row of rows) {
      const rowText = row.innerText.toLowerCase();
      const dateMatch = dateValue === "" || row.cells[0].innerText === dateValue;
      const searchMatch = rowText.includes(searchValue);
      row.style.display = (searchMatch && dateMatch) ? "" : "none";
    }
  }

  searchInput.addEventListener('keyup', filterTable);
  dateFilter.addEventListener('change', filterTable);
</script>


{% endblock %}
